# API接口对比分析与修复计划

## 目标
对比当前分支（queries-optimization）与main分支的API接口差异，并修复所有不一致之处，确保API兼容性。

## 执行步骤

### 第一步：获取分支差异信息
1. 使用git diff命令获取两个分支之间的文件变更列表
2. 筛选出所有API控制器文件（`.controller.ts`）
3. 筛选出所有DTO文件（`request.dto.ts`, `response.dto.ts`）
4. 识别新增、修改、删除的文件

### 第二步：API接口详细对比
1. **接口路径对比**：
   - 对比每个Controller的`@Controller`装饰器路径
   - 对比每个端点的路由路径（`@Get`, `@Post`, `@Patch`, `@Delete`等）
   
2. **请求方法对比**：
   - 确认HTTP方法是否一致
   - 检查是否有方法变更（如GET改为POST）

3. **请求参数对比**：
   - 对比Query参数（`@Query`装饰器）
   - 对比Body参数（`@Body`装饰器）
   - 对比Path参数（`@Param`装饰器）
   - 检查参数名称、类型、必填性是否一致

4. **响应格式对比**：
   - 对比Response DTO的结构
   - 检查字段名称、类型、是否可选
   - 确认状态码是否一致

5. **权限控制对比**：
   - 对比`@Roles`装饰器
   - 确认访问控制策略是否一致

### 第三步：识别差异并分类
将发现的差异分为以下几类：
- **破坏性变更**：需要修复以保持兼容性
- **非破坏性变更**：可以保留但需要文档说明
- **新增接口**：需要确认是否符合设计规范
- **删除接口**：需要确认是否应该保留

### 第四步：修复差异
根据main分支的API规范，修复当前分支中的差异：
1. 修复接口路径不一致
2. 修复请求方法不一致
3. 修复请求参数不一致
4. 修复响应格式不一致
5. 修复权限控制不一致

### 第五步：验证修复结果
1. 运行TypeScript编译检查
2. 确保所有编译错误已解决
3. 确保API接口与main分支完全一致

## 预期成果
- 所有API接口与main分支保持一致
- 确保系统兼容性
- 无编译错误
- 完整的差异分析报告